@page
@model _17nsj.Jedi.Pages.UserManageModel
@using _17nsj.Jedi.Domains;
@using _17nsj.Jedi.Extensions;
@{
    ViewData["Title"] = "ユーザー管理";
}

<section class="content">
    <div>
        <div class="box box-primary">
            <div class="box-body">
                <div class="col-md-8 col-md-offset-2">
                    @using (Html.BeginForm(FormMethod.Post))
                    {
                        @Html.HiddenFor(modelitem => Model.IsEditMode)
                        @Html.HiddenFor(modelitem => Model.TargetUser.UpdatedAt)
                        <div class="form-horizontal">
                            <div class="box-body">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">ユーザーID</label>
                                    <div class="col-sm-9">
                                        @if (Model.IsEditMode)
                                        {
                                            <label class="form-text">@Model.TargetUser.UserId</label>
                                            @Html.HiddenFor(modelitem => Model.TargetUser.UserId)
                                        }
                                        else
                                        {
                                            @Html.TextBoxFor(modelitem => Model.TargetUser.UserId, new { @class = "form-control" })
                                        }
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">表示名</label>
                                    <div class="col-sm-9">
                                        @Html.TextBoxFor(modelitem => Model.TargetUser.DisplayName, new { @class = "form-control" })
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">所属</label>
                                    <div class="col-sm-9">
                                        @if (Model.IsEditMode)
                                        {

                                            @if (!Model.IsSysAdmin)
                                            {
                                                // 管理者の場合は自信と同じ所属のユーザーのみ
                                                <label class="form-text">@Model.TargetUser.AffiliationName</label>
                                                @Html.HiddenFor(modelitem => Model.TargetUser.Affiliation)
                                            }
                                            else
                                            {
                                                @Html.DropDownListFor(model => model.TargetUser.Affiliation, TeamDomain.DomainList.ToSelectListItems(), null, new { @class = "form-control" })
                                            }
                                        }
                                        else
                                        {
                                            @if (!Model.IsSysAdmin)
                                            {
                                                // 管理者の場合は自信と同じ所属のユーザーのみ
                                                <label class="form-text">@Model.UserAffiliationName</label>
                                            }
                                            else
                                            {
                                                @Html.DropDownListFor(model => model.TargetUser.Affiliation, TeamDomain.DomainList.ToSelectListItems(), null, new { @class = "form-control" })
                                            }
                                        }
                                    </div>
                                </div>
                                @if (!Model.IsEditMode)
                                {
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">初期パスワード</label>
                                        <div class="col-sm-9">
                                            @Html.PasswordFor(modelitem => Model.TargetUser.Password, new { @class = "form-control" })
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">初期パスワード(確認)</label>
                                        <div class="col-sm-9">
                                            @Html.PasswordFor(modelitem => Model.TargetUser.RePassword, new { @class = "form-control" })
                                        </div>
                                    </div>
                                }
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">権限</label>
                                    <div class="col-sm-9 form-text">
                                        <label data-toggle="tooltip" data-placement="bottom" title="ユーザーを作成すると自動的に読取り権限が付与されます。">
                                            @Html.CheckBoxFor(modelitem => Model.TargetUser.CanRead)
                                            読み取り
                                        </label>
                                        <label>
                                            @Html.CheckBoxFor(modelitem => Model.TargetUser.CanWrite)
                                            書き込み
                                        </label>
                                        <label data-toggle="tooltip" data-placement="bottom" title="管理者権限ユーザーを作成することはできません。">
                                            @Html.CheckBoxFor(modelitem => Model.TargetUser.IsAdmin, new { @disabled = "disabled" })
                                            管理者
                                        </label>
                                        <label data-toggle="tooltip" data-placement="bottom" title="システム管理者権限ユーザーを作成することはできません。">
                                            @Html.CheckBoxFor(modelitem => Model.TargetUser.IsSysAdmin, new { @disabled = "disabled" })
                                            システム管理者
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="box-footer">
                                <button type="submit" class="btn btn-success pull-right">登録</button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>